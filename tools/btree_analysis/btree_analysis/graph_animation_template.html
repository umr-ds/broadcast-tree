<!DOCTYPE html>
<meta charset="utf-8">
<body>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://unpkg.com/@hpcc-js/wasm@1.14.1/dist/index.min.js"></script>
<script src="https://unpkg.com/d3-graphviz@4.1.1/build/d3-graphviz.js"></script>

<button onclick="run_button(false)">Stop</button>
<button onclick="run_button(true)">Resume</button>

<button onclick="step_button(1)">Step</button>
<button onclick="step_button(-1)">Back</button>

<div id="graph" style="text-align: center;"></div>

<script>
var running = true;
var dotIndex = 0;

function run_button(state) {
    running = state;

    if (running) {
        render();
    }
}

function step_button(direction) {
    dotIndex += direction;
    render();
}

var graphviz = d3.select("#graph").graphviz()
    .transition(function () {
        return d3.transition("main")
            .ease(d3.easeLinear)
            .delay(100)
            .duration(100);
    })
    .logEvents(true)
    .on("initEnd", render);

function render() {
    var dot = dots[dotIndex];
    graphviz
        .renderDot(dot)
        .on("end", function () {
            if (running) {
                dotIndex = (dotIndex + 1) % dots.length;
                render();
            }
        });
}

var dots = [
    {graph_series}
];

</script>
